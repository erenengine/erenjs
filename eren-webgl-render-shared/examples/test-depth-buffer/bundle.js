(()=>{"use strict";const e=WebGL2RenderingContext.ARRAY_BUFFER,t=WebGL2RenderingContext.ELEMENT_ARRAY_BUFFER,r=WebGL2RenderingContext.STATIC_DRAW,o=WebGL2RenderingContext.FLOAT,i=WebGL2RenderingContext.LESS;class a{#e;#t;constructor(e,t,r){this.#e=e,this.#t=this.#e.createProgram(t,r)}use(){this.#e.useProgram(this.#t)}getUniformLocation(e){return this.#e.getUniformLocation(this.#t,e)}}var n,s=1e-6,l="undefined"!=typeof Float32Array?Float32Array:Array;function h(e,t,r){var o=new l(3);return o[0]=e,o[1]=t,o[2]=r,o}function E(){var e=new l(16);return l!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),n=new l(3),l!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0);const g={r:.1921,g:.302,b:.4745,a:1},c=[{pos:h(-.5,-.5,0),color:h(1,0,0)},{pos:h(.5,-.5,0),color:h(0,1,0)},{pos:h(.5,.5,0),color:h(0,0,1)},{pos:h(-.5,.5,0),color:h(1,1,1)},{pos:h(-.5,-.5,-.5),color:h(1,0,0)},{pos:h(.5,-.5,-.5),color:h(0,1,0)},{pos:h(.5,.5,-.5),color:h(0,0,1)},{pos:h(-.5,.5,-.5),color:h(1,1,1)}],u=[0,1,2,2,3,0,4,5,6,6,7,4];class T{#e;#t;#r;#o;#i;#a;#n;constructor(e){this.#e=e,this.#t=new a(e,"#version 300 es\nprecision mediump float;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProj;\n\nin vec3 aPosition;\nin vec3 aColor;\n\nout vec3 vColor;\n\nvoid main() {\n    gl_Position = uProj * uView * uModel * vec4(aPosition, 1.0);\n    vColor = aColor;\n}\n","#version 300 es\nprecision mediump float;\n\nin  vec3 vColor;\nout vec4 outColor;\n\nvoid main() {\n    outColor = vec4(vColor, 1.0);\n}\n"),e.enableDepthTest(),e.depthFunc(i),e.clearDepth(1),this.#r=e.createVertexArray(function(e){const t=new Float32Array(6*e.length);for(let r=0;r<e.length;r++){const o=6*r;t.set(e[r].pos,o+0),t.set(e[r].color,o+3)}return t}(c),new Uint16Array(u)),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,3,o,!1,24,0),e.enableVertexAttribArray(1),e.vertexAttribPointer(1,3,o,!1,24,12);const t=this.#t.getUniformLocation("uModel"),r=this.#t.getUniformLocation("uView"),n=this.#t.getUniformLocation("uProj");if(!t)throw new Error("Failed to get uniform location (uModel)");if(!r)throw new Error("Failed to get uniform location (uView)");if(!n)throw new Error("Failed to get uniform location (uProj)");this.#o=t,this.#i=r,this.#a=n,this.#n=Date.now()}#s(e,t){const r=(performance.now()-this.#n)/1e3,o={model:E(),view:E(),proj:E()};!function(e,t){var r=Math.sin(t),o=Math.cos(t);e[0]=o,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(o.model,-90*r*Math.PI/180);const i=h(2,2,2),a=h(0,0,0),n=h(0,0,1);!function(e,t,r,o){var i,a,n,l,h,E,g,c,u,T,f=t[0],d=t[1],m=t[2],R=o[0],b=o[1],A=o[2],F=r[0],_=r[1],P=r[2];Math.abs(f-F)<s&&Math.abs(d-_)<s&&Math.abs(m-P)<s?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(g=f-F,c=d-_,u=m-P,i=b*(u*=T=1/Math.hypot(g,c,u))-A*(c*=T),a=A*(g*=T)-R*u,n=R*c-b*g,(T=Math.hypot(i,a,n))?(i*=T=1/T,a*=T,n*=T):(i=0,a=0,n=0),l=c*n-u*a,h=u*i-g*n,E=g*a-c*i,(T=Math.hypot(l,h,E))?(l*=T=1/T,h*=T,E*=T):(l=0,h=0,E=0),e[0]=i,e[1]=l,e[2]=g,e[3]=0,e[4]=a,e[5]=h,e[6]=c,e[7]=0,e[8]=n,e[9]=E,e[10]=u,e[11]=0,e[12]=-(i*f+a*d+n*m),e[13]=-(l*f+h*d+E*m),e[14]=-(g*f+c*d+u*m),e[15]=1)}(o.view,i,a,n);const l=e/t;return function(e,t,r,o,i){var a,n=1/Math.tan(t/2);e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(a=1/(o-i),e[10]=(i+o)*a,e[14]=2*i*o*a):(e[10]=-1,e[14]=-2*o)}(o.proj,Math.PI/4,l,.1,10),o}recordCommands(e,t){this.#e.clearColor(g),this.#t.use(),this.#e.bindVertexArray(this.#r);const r=this.#s(e,t);this.#e.uniformMatrix4fv(this.#o,!1,r.model),this.#e.uniformMatrix4fv(this.#i,!1,r.view),this.#e.uniformMatrix4fv(this.#a,!1,r.proj),this.#e.drawElements(u.length)}}const f=document.getElementById("canvas"),d=new class{#e;constructor(e){this.#e=e}#l(e,t){const r=this.#e.createShader(t);if(!r)throw new Error("Failed to create shader");if(this.#e.shaderSource(r,e),this.#e.compileShader(r),!this.#e.getShaderParameter(r,this.#e.COMPILE_STATUS)){const e=this.#e.getShaderInfoLog(r);throw this.#e.deleteShader(r),new Error("Failed to compile shader: "+e)}return r}createProgram(e,t){const r=this.#l(e,this.#e.VERTEX_SHADER),o=this.#l(t??"#version 300 es\nprecision mediump float;\nvoid main() { }",this.#e.FRAGMENT_SHADER),i=this.#e.createProgram();if(this.#e.attachShader(i,r),o&&this.#e.attachShader(i,o),this.#e.linkProgram(i),!this.#e.getProgramParameter(i,this.#e.LINK_STATUS)){const e=this.#e.getProgramInfoLog(i);throw this.#e.deleteProgram(i),new Error("Failed to link program: "+e)}return i}useProgram(e){this.#e.useProgram(e)}createVertexArray(o,i){const a=this.#e.createVertexArray();this.#e.bindVertexArray(a);const n=this.#e.createBuffer();if(this.#e.bindBuffer(e,n),this.#e.bufferData(e,o,r),i){const e=this.#e.createBuffer();this.#e.bindBuffer(t,e),this.#e.bufferData(t,i,r)}return a}bindVertexArray(e){this.#e.bindVertexArray(e)}createBuffer(){return this.#e.createBuffer()}bindBuffer(e,t){this.#e.bindBuffer(e,t)}bufferData(e,t,r){this.#e.bufferData(e,t,r)}enableVertexAttribArray(e){this.#e.enableVertexAttribArray(e)}vertexAttribPointer(e,t,r,o,i,a){this.#e.vertexAttribPointer(e,t,r,o,i,a)}uniformMatrix4fv(e,t,r){this.#e.uniformMatrix4fv(e,t,r)}uniform3fv(e,t){this.#e.uniform3fv(e,t)}getUniformLocation(e,t){return this.#e.getUniformLocation(e,t)}clearColor(e){this.#e.clearColor(e.r,e.g,e.b,e.a),this.#e.clear(this.#e.COLOR_BUFFER_BIT)}draw(e,t){this.#e.drawArraysInstanced(this.#e.TRIANGLES,0,e,t)}drawElements(e){this.#e.drawElements(this.#e.TRIANGLES,e,this.#e.UNSIGNED_SHORT,0)}drawIndexed(e,t){this.#e.drawElementsInstanced(this.#e.TRIANGLE_STRIP,e,this.#e.UNSIGNED_SHORT,0,t)}enableDepthTest(){this.#e.enable(this.#e.DEPTH_TEST)}disableDepthTest(){this.#e.disable(this.#e.DEPTH_TEST)}depthFunc(e){this.#e.depthFunc(e)}clearDepth(e){this.#e.clearDepth(e),this.#e.clear(this.#e.DEPTH_BUFFER_BIT)}createDepthTexture(e,t){const r=this.#e,o=r.createTexture();if(!o)throw new Error("Failed to create depth texture");return r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.DEPTH_COMPONENT24,e,t,0,r.DEPTH_COMPONENT,r.UNSIGNED_INT,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,r.LESS),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),o}createDepthFramebuffer(e){const t=this.#e,r=t.createFramebuffer();if(!r)throw new Error("Failed to create shadow framebuffer");t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,e,0),t.drawBuffers([t.NONE]),t.readBuffer(t.NONE);const o=t.checkFramebufferStatus(t.FRAMEBUFFER);if(o!==t.FRAMEBUFFER_COMPLETE)throw new Error(`Incomplete shadow framebuffer: 0x${o.toString(16)}`);return t.bindFramebuffer(t.FRAMEBUFFER,null),r}bindDepthFramebuffer(e){this.#e.bindFramebuffer(this.#e.FRAMEBUFFER,e),this.#e.colorMask(!1,!1,!1,!1)}restoreFramebufferDefaultState(){this.#e.bindVertexArray(null),this.#e.bindFramebuffer(this.#e.FRAMEBUFFER,null),this.#e.colorMask(!0,!0,!0,!0)}deleteTexture(e){this.#e.deleteTexture(e)}deleteFramebuffer(e){this.#e.deleteFramebuffer(e)}bindTextureToSamplerForRawDepth(e,t){const r=this.#e;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,e);const o=r.getTexParameter(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE);return o!==r.NONE&&r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.NONE),r.uniform1i(t,0),o}restoreTextureState(e){const t=this.#e;t.bindVertexArray(null),e!==t.NONE&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_MODE,e),t.bindTexture(t.TEXTURE_2D,null),t.enable(t.DEPTH_TEST)}}(f.getContext("webgl2")),m=new class{#h;constructor(e){this.#h=new T(e)}render(e,t){this.#h.recordCommands(e,t)}}(d);!function e(){m.render(f.width,f.height),requestAnimationFrame(e)}()})();