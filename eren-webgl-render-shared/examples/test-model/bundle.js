(()=>{"use strict";var e,t,r,o,a={38:(e,t,r)=>{r.d(t,{fA:()=>n,vt:()=>a});var o=r(531);function a(){var e=new o.tb(2);return o.tb!=Float32Array&&(e[0]=0,e[1]=0),e}function n(e,t){var r=new o.tb(2);return r[0]=e,r[1]=t,r}a()},148:(e,t,r)=>{r.d(t,{w:()=>n});var o=r(759);const a=8;function n(e,t,r){const n=e.createVertexArray(function(e){const t=new Float32Array(e.length*a);for(let r=0;r<e.length;r++){const o=e[r],n=r*a;t.set(o.position,n+0),t.set(o.normal,n+3),t.set(o.texCoord,n+6)}return t}(t),new Uint16Array(r));return e.enableVertexAttribArray(0),e.vertexAttribPointer(0,3,o.zH,!1,32,0),e.enableVertexAttribArray(1),e.vertexAttribPointer(1,3,o.zH,!1,32,12),e.enableVertexAttribArray(2),e.vertexAttribPointer(2,2,o.zH,!1,32,24),{vao:n,indexCount:r.length}}},351:(e,t,r)=>{r.d(t,{vt:()=>s,x8:()=>h});var o,a=r(531),n=r(741),i=r(429);function s(){var e=new a.tb(4);return a.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function h(e,t,r){r*=.5;var o=Math.sin(r);return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=Math.cos(r),e}o=new a.tb(4),a.tb!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0);i.vt(),i.fA(1,0,0),i.fA(0,1,0),s(),s(),n.vt()},359:(e,t,r)=>{r.d(t,{q:()=>n});var o=r(429),a=r(38);class n{#e;#t;#r;#o;#a;#n;constructor(e,t="untitled"){this.#e=e,this.#t=t}parse(){return this.#i(),this.#e.split(/\r?\n/).forEach((e=>{const t=(e=>{const t=e.indexOf("#");return t>=0?e.slice(0,t):e})(e).replace(/\s\s+/g," ").trim();if(0===t.length)return;const r=t.split(" ");switch(r[0].toLowerCase()){case"o":this.#s(r);break;case"g":this.#h(r);break;case"v":this.#u(r);break;case"vt":this.#l(r);break;case"vn":this.#c(r);break;case"s":this.#d(r);break;case"f":this.#f(r);break;case"mtllib":this.#g(r);break;case"usemtl":this.#m(r)}})),this.#r}#i(){this.#r={models:[],materialLibraries:[]},this.#o="",this.#a="",this.#n=0}#p(){return 0===this.#r.models.length&&this.#r.models.push({name:this.#t,vertices:[],textureCoords:[],vertexNormals:[],faces:[]}),this.#r.models[this.#r.models.length-1]}#s(e){const t=e[1]??this.#t;this.#r.models.push({name:t,vertices:[],textureCoords:[],vertexNormals:[],faces:[]}),this.#a="",this.#n=0}#h(e){if(2!==e.length)throw new Error('Group statements must have exactly 1 argument (e.g. "g group_1").');this.#a=e[1]}#u(e){const[t="0",r="0",a="0"]=e.slice(1);this.#p().vertices.push(o.fA(parseFloat(t),parseFloat(r),parseFloat(a)))}#l(e){const[t="0",r="0"]=e.slice(1);this.#p().textureCoords.push(a.fA(parseFloat(t),parseFloat(r)))}#c(e){const[t="0",r="0",a="0"]=e.slice(1);this.#p().vertexNormals.push(o.fA(parseFloat(t),parseFloat(r),parseFloat(a)))}#d(e){if(2!==e.length)throw new Error('Smoothing group statements must have exactly 1 argument (e.g. "s 1" or "s off").');this.#n="off"===e[1].toLowerCase()?0:parseInt(e[1],10)}#f(e){if(e.length<4)throw new Error('Face statement must have at least 3 vertices (e.g. "f v1 v2 v3").');const t={material:this.#o,group:this.#a,smoothingGroup:this.#n,vertices:[]};e.slice(1).forEach((e=>{const r=e.split("/");if(r.length<1||r.length>3)throw new Error("Invalid vertex specification inside face.");let[o,a,n]=r,i=parseInt(o,10);if(0===i)throw new Error("OBJ vertex indices are 1-based and may not be zero.");i<0&&(i=this.#p().vertices.length+1+i),t.vertices.push({vertexIndex:i,textureCoordsIndex:a?parseInt(a,10):0,vertexNormalIndex:n?parseInt(n,10):0})})),this.#p().faces.push(t)}#g(e){e.length>=2&&this.#r.materialLibraries.push(e[1])}#m(e){e.length>=2&&(this.#o=e[1])}}},398:(e,t,r)=>{r.a(e,(async(e,t)=>{try{var o=r(759),a=r(148),n=r(359),i=r(408),s=r(741),h=r(351),u=r(429),l=r(38);const c=document.getElementById("canvas"),d=new o.GL(c.getContext("webgl2")),f=await fetch("./assets/viking_room.png"),g=await f.blob(),m=await createImageBitmap(g),p=new i.O(d,c.width,c.height,m);function w(e){const t=new n.q(new TextDecoder("utf-8").decode(e)),{models:r}=t.parse();if(!r.length)throw new Error("OBJ에는 최소 1개의 모델(o)이 필요합니다.");const o=r[0],a=[],i=[],c=new Map,d=s.I0(s.vt(),h.x8(h.vt(),[1,0,0],1.5*Math.PI)),f=(e,t)=>{const r=e[t-1];return u.fA(r[0],r[1],r[2])},g=(e,t)=>{const r=e[t-1];return l.fA(r[0],1-r[1])};for(const e of o.faces)for(const t of e.vertices){const e=`${t.vertexIndex}/${t.vertexNormalIndex}/${t.textureCoordsIndex}`;let r=c.get(e);if(void 0===r){const n=f(o.vertices,t.vertexIndex);u.ei(n,n,d);const i=t.vertexNormalIndex?f(o.vertexNormals,t.vertexNormalIndex):u.fA(0,1,0),s=t.textureCoordsIndex?g(o.textureCoords,t.textureCoordsIndex):l.vt();r=a.length,a.push({position:n,normal:i,texCoord:s}),c.set(e,r)}i.push(r)}return{vertices:a,indices:i}}function x(){const e=u.fA(0,1,0);return{vertices:[u.fA(-5,-1,-5),u.fA(5,-1,-5),u.fA(5,-1,5),u.fA(-5,-1,5)].map((t=>({position:t,normal:e,texCoord:l.fA(0,0)}))),indices:[0,2,1,2,0,3]}}const T=await fetch("./assets/viking_room.obj").then((e=>e.arrayBuffer())),v=w(new Uint8Array(T)),E=x(),b=[(0,a.w)(d,v.vertices,v.indices),(0,a.w)(d,E.vertices,E.indices)];function P(){p.render(b,c.width,c.height),requestAnimationFrame(P)}P(),t()}catch(L){t(L)}}),1)},408:(e,t,r)=>{r.d(t,{O:()=>g});var o=r(429),a=r(531);function n(){var e=new a.tb(16);return a.tb!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function i(e,t,r,o){var n,i,s,h,u,l,c,d,f,g,m=t[0],p=t[1],w=t[2],x=o[0],T=o[1],v=o[2],E=r[0],b=r[1],P=r[2];return Math.abs(m-E)<a.p8&&Math.abs(p-b)<a.p8&&Math.abs(w-P)<a.p8?function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(e):(c=m-E,d=p-b,f=w-P,n=T*(f*=g=1/Math.hypot(c,d,f))-v*(d*=g),i=v*(c*=g)-x*f,s=x*d-T*c,(g=Math.hypot(n,i,s))?(n*=g=1/g,i*=g,s*=g):(n=0,i=0,s=0),h=d*s-f*i,u=f*n-c*s,l=c*i-d*n,(g=Math.hypot(h,u,l))?(h*=g=1/g,u*=g,l*=g):(h=0,u=0,l=0),e[0]=n,e[1]=h,e[2]=c,e[3]=0,e[4]=i,e[5]=u,e[6]=d,e[7]=0,e[8]=s,e[9]=l,e[10]=f,e[11]=0,e[12]=-(n*m+i*p+s*w),e[13]=-(h*m+u*p+l*w),e[14]=-(c*m+d*p+f*w),e[15]=1,e)}class s{#w;#x;constructor(e,t,r){this.#w=e,this.#x=this.#w.createProgram(t,r)}use(){this.#w.useProgram(this.#x)}getUniformLocation(e){const t=this.#w.getUniformLocation(this.#x,e);if(!t)throw new Error(`Failed to get uniform location (${e})`);return t}}const h={r:.1921,g:.302,b:.4745,a:1};class u{#w;#x;#T;#v;constructor(e,t){this.#w=e,this.#x=new s(e,"#version 300 es\n\nout vec2 fragUV;\n\nconst vec2 positions[3] = vec2[](\n    vec2(-1.0, -1.0),\n    vec2(-1.0,  3.0),\n    vec2( 3.0, -1.0)\n);\n\nconst vec2 uvs[3] = vec2[](\n    vec2(0.0, 0.0),\n    vec2(0.0, 2.0),\n    vec2(2.0, 0.0)\n);\n\nvoid main() {\n    gl_Position = vec4(positions[gl_VertexID], 0.0, 1.0);\n    fragUV = uvs[gl_VertexID];\n}\n","#version 300 es\nprecision highp float;\n\nin vec2 fragUV;\n\nout vec4 outColor;\n\nuniform sampler2D shadowMap;\n\nvoid main() {\n    float depth = texture(shadowMap, fragUV).r;\n    outColor = vec4(vec3(depth), 1.0); // 흑백 시각화\n}\n"),this.#T=t;const r=this.#x.getUniformLocation("shadowMap");if(!r)throw new Error("Failed to get uniform location (shadowMap)");this.#v=r}rebindShadowTexture(e){this.#T=e}recordCommands(){this.#w.clearColor(h),this.#x.use(),this.#w.bindRawDepthTexture(0,this.#T,this.#v),this.#w.draw(3,1)}}var l=r(759);class c{shadowTexture;#w;#x;#E;#b;#P;constructor(e,t,r){this.#w=e,this.#x=new s(e,"#version 300 es\n\nlayout(location = 0) in vec3 inPosition;\n\nuniform mat4 uLightViewProj;\n\nvoid main() {\n    gl_Position = uLightViewProj * vec4(inPosition, 1.0);\n}\n"),this.#E=this.#x.getUniformLocation("uLightViewProj"),e.enableDepthTest(),e.depthFunc(l.ae),this.shadowTexture=e.createDepthTexture(t,r),this.#b=e.createDepthFramebuffer(this.shadowTexture)}resizeShadowTexture(e,t){const r=this.#w;r.deleteTexture(this.shadowTexture),r.deleteFramebuffer(this.#b),this.shadowTexture=r.createDepthTexture(e,t),this.#b=r.createDepthFramebuffer(this.shadowTexture)}updateShadowUBO(e){this.#P=e}recordCommands(e){const t=this.#w;t.bindDepthFramebuffer(this.#b),t.clearDepth(1),this.#x.use(),this.#P&&t.uniformMatrix4fv(this.#E,!1,this.#P.lightViewProj);for(const r of e)t.bindVertexArray(r.vao),t.drawElements(r.indexCount);t.restoreFramebufferDefaultState()}}const d={r:.1921,g:.302,b:.4745,a:1};class f{#w;#x;#T;#L;#A;#M;#E;#U;#R;#v;#_;#C;#F;#D;constructor(e,t,r){this.#D=e.createImageTexture(r),this.#w=e,this.#T=t,this.#x=new s(e,"#version 300 es\n\nlayout(location = 0) in vec3 inPosition;\nlayout(location = 1) in vec3 inNormal;\nlayout(location = 2) in vec2 inTexCoord;\n\nout vec3 fragPosWorld;\nout vec3 normalWorld;\nout vec4 shadowCoord;\nout vec2 fragTexCoord;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProj;\nuniform mat4 uLightViewProj;\n\nvoid main() {\n    vec4 worldPos = uModel * vec4(inPosition, 1.0);\n\n    fragPosWorld = worldPos.xyz;\n    normalWorld = mat3(transpose(inverse(uModel))) * inNormal;\n    shadowCoord = uLightViewProj * worldPos;\n    fragTexCoord = inTexCoord;\n\n    gl_Position = uProj * uView * worldPos;\n}\n","#version 300 es\nprecision highp float;\n\nin vec3 fragPosWorld;\nin vec3 normalWorld;\nin vec4 shadowCoord;\nin vec2 fragTexCoord;\n\nout vec4 outColor;\n\nuniform vec3 uLightDirection;  // 단위벡터\nuniform vec3 uLightColor;      // 빛 색상\n\nuniform sampler2D shadowMap;\nuniform sampler2D uTextureSampler;\n\nfloat calculateShadow(vec4 shadowCoord) {\n    vec3 projCoords = shadowCoord.xyz / shadowCoord.w;\n\n    // X, Y [-1,1] → [0,1]\n    vec2 shadowTexCoord = projCoords.xy * 0.5 + 0.5;\n    float currentDepth = projCoords.z * 0.5 + 0.5;\n\n    // 범위 밖이면 그림자 없음\n    if (currentDepth > 1.0 || shadowTexCoord.x < 0.0 || shadowTexCoord.x > 1.0 ||\n        shadowTexCoord.y < 0.0 || shadowTexCoord.y > 1.0) {\n        return 0.0;\n    }\n\n    float bias = max(0.005 * (1.0 - dot(normalize(normalWorld), normalize(-uLightDirection))), 0.0005);\n\n    float shadow = 0.0;\n    float texelSize = 1.0 / 2048.0;\n\n    for (int x = -1; x <= 1; ++x) {\n        for (int y = -1; y <= 1; ++y) {\n            vec2 offset = vec2(x, y) * texelSize;\n            float closestDepth = texture(shadowMap, shadowTexCoord + offset).r;\n            shadow += (currentDepth - bias > closestDepth) ? 1.0 : 0.0;\n        }\n    }\n\n    shadow /= 9.0;\n\n    return shadow;\n}\n\nvoid main() {\n    vec3 norm = normalize(normalWorld);\n    vec3 lightDir = normalize(-uLightDirection);\n\n    float ambientStrength = 0.1;\n    vec3 ambient = ambientStrength * uLightColor;\n\n    float diff = max(dot(norm, lightDir), 0.0);\n    vec3 diffuse = uLightColor * diff;\n\n    float shadow = calculateShadow(shadowCoord);\n\n    vec3 baseColor;\n    if (fragPosWorld.y == -1.0) {\n        baseColor = vec3(0.8, 0.8, 0.8); // 땅\n    } else {\n        baseColor = texture(uTextureSampler, fragTexCoord).rgb; // 큐브\n    }\n\n    vec3 lighting = ambient + (1.0 - shadow) * diffuse;\n\n    outColor = vec4(baseColor * lighting, 1.0);\n}\n"),this.#L=this.#x.getUniformLocation("uModel"),this.#A=this.#x.getUniformLocation("uView"),this.#M=this.#x.getUniformLocation("uProj"),this.#E=this.#x.getUniformLocation("uLightViewProj"),this.#U=this.#x.getUniformLocation("uLightDirection"),this.#R=this.#x.getUniformLocation("uLightColor"),this.#v=this.#x.getUniformLocation("shadowMap"),this.#_=this.#x.getUniformLocation("uTextureSampler"),e.enableDepthTest(),e.depthFunc(l.ae)}rebindShadowTexture(e){this.#T=e}updateMainUBO(e){this.#C=e}updateLightUBO(e){this.#F=e}recordCommands(e){const t=this.#w;t.clearColor(d),t.clearDepth(1),this.#x.use(),this.#C&&(t.uniformMatrix4fv(this.#L,!1,this.#C.model),t.uniformMatrix4fv(this.#A,!1,this.#C.view),t.uniformMatrix4fv(this.#M,!1,this.#C.proj),t.uniformMatrix4fv(this.#E,!1,this.#C.lightViewProj)),this.#F&&(t.uniform3fv(this.#U,this.#F.direction),t.uniform3fv(this.#R,this.#F.color)),t.bindRawDepthTexture(0,this.#T,this.#v),t.bindImageTexture(1,this.#D,this.#_);for(const r of e)t.bindVertexArray(r.vao),t.drawElements(r.indexCount)}}class g{#S;#y;#I;#O;constructor(e,t,r,o){this.#S=new c(e,t,r),this.#y=new u(e,this.#S.shadowTexture),this.#I=new f(e,this.#S.shadowTexture,o),this.#O=performance.now()}resize(e,t){this.#S.resizeShadowTexture(e,t),this.#y.rebindShadowTexture(this.#S.shadowTexture),this.#I.rebindShadowTexture(this.#S.shadowTexture)}render(e,t,r){const a=(performance.now()-this.#O)/1e3,s=8*Math.cos(.2*a),h=8*Math.sin(.2*a),u=o.fA(s,6,h),l=n();var c,d,f,g,m,p,w,x,T,v;x=1/((d=-10)-(f=10)),T=1/((g=-10)-(m=10)),v=1/((p=-10)-(w=20)),(c=l)[0]=-2*x,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*T,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*v,c[11]=0,c[12]=(d+f)*x,c[13]=(m+g)*T,c[14]=(w+p)*v,c[15]=1;const E=n();i(E,u,o.fA(0,0,0),o.fA(0,1,0));const b=n();(function(e,t,r){var o=t[0],a=t[1],n=t[2],i=t[3],s=t[4],h=t[5],u=t[6],l=t[7],c=t[8],d=t[9],f=t[10],g=t[11],m=t[12],p=t[13],w=t[14],x=t[15],T=r[0],v=r[1],E=r[2],b=r[3];e[0]=T*o+v*s+E*c+b*m,e[1]=T*a+v*h+E*d+b*p,e[2]=T*n+v*u+E*f+b*w,e[3]=T*i+v*l+E*g+b*x,T=r[4],v=r[5],E=r[6],b=r[7],e[4]=T*o+v*s+E*c+b*m,e[5]=T*a+v*h+E*d+b*p,e[6]=T*n+v*u+E*f+b*w,e[7]=T*i+v*l+E*g+b*x,T=r[8],v=r[9],E=r[10],b=r[11],e[8]=T*o+v*s+E*c+b*m,e[9]=T*a+v*h+E*d+b*p,e[10]=T*n+v*u+E*f+b*w,e[11]=T*i+v*l+E*g+b*x,T=r[12],v=r[13],E=r[14],b=r[15],e[12]=T*o+v*s+E*c+b*m,e[13]=T*a+v*h+E*d+b*p,e[14]=T*n+v*u+E*f+b*w,e[15]=T*i+v*l+E*g+b*x})(b,l,E),this.#S.updateShadowUBO({lightViewProj:b}),this.#S.recordCommands(e);{const s=o.fA(8*Math.cos(-.1*a),6,8*Math.sin(-.1*a)),h=n();i(h,s,o.fA(0,0,0),o.fA(0,1,0));const l=n();!function(e,t,r,o,a){var n,i=1/Math.tan(t/2);e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(n=1/(o-a),e[10]=(a+o)*n,e[14]=2*a*o*n):(e[10]=-1,e[14]=-2*o)}(l,15*Math.PI/180,t/r,.1,100);const c={model:n(),view:h,proj:l,lightViewProj:b};this.#I.updateMainUBO(c);const d=o.vt();o.Re(d,o.fA(0,0,0),u),o.S8(d,d);const f={direction:d,color:o.fA(1,1,1)};this.#I.updateLightUBO(f),this.#I.recordCommands(e)}}}},429:(e,t,r)=>{r.d(t,{$A:()=>u,Il:()=>c,Om:()=>h,Re:()=>i,S8:()=>s,ei:()=>l,fA:()=>n,vt:()=>a});var o=r(531);function a(){var e=new o.tb(3);return o.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function n(e,t,r){var a=new o.tb(3);return a[0]=e,a[1]=t,a[2]=r,a}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function s(e,t){var r=t[0],o=t[1],a=t[2],n=r*r+o*o+a*a;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function h(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function u(e,t,r){var o=t[0],a=t[1],n=t[2],i=r[0],s=r[1],h=r[2];return e[0]=a*h-n*s,e[1]=n*i-o*h,e[2]=o*s-a*i,e}function l(e,t,r){var o=t[0],a=t[1],n=t[2];return e[0]=o*r[0]+a*r[3]+n*r[6],e[1]=o*r[1]+a*r[4]+n*r[7],e[2]=o*r[2]+a*r[5]+n*r[8],e}var c=function(e){var t=e[0],r=e[1],o=e[2];return Math.hypot(t,r,o)};a()},531:(e,t,r)=>{r.d(t,{p8:()=>o,tb:()=>a});var o=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)})},741:(e,t,r)=>{r.d(t,{I0:()=>n,vt:()=>a});var o=r(531);function a(){var e=new o.tb(9);return o.tb!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function n(e,t){var r=t[0],o=t[1],a=t[2],n=t[3],i=r+r,s=o+o,h=a+a,u=r*i,l=o*i,c=o*s,d=a*i,f=a*s,g=a*h,m=n*i,p=n*s,w=n*h;return e[0]=1-c-g,e[3]=l-w,e[6]=d+p,e[1]=l+w,e[4]=1-u-g,e[7]=f-m,e[2]=d-p,e[5]=f+m,e[8]=1-u-c,e}},759:(e,t,r)=>{r.d(t,{GL:()=>h,ae:()=>s,zH:()=>i});const o=WebGL2RenderingContext.ARRAY_BUFFER,a=WebGL2RenderingContext.ELEMENT_ARRAY_BUFFER,n=WebGL2RenderingContext.STATIC_DRAW,i=WebGL2RenderingContext.FLOAT,s=WebGL2RenderingContext.LESS;class h{#w;constructor(e){this.#w=e}#B(e,t){const r=this.#w.createShader(t);if(!r)throw new Error("Failed to create shader");if(this.#w.shaderSource(r,e),this.#w.compileShader(r),!this.#w.getShaderParameter(r,this.#w.COMPILE_STATUS)){const e=this.#w.getShaderInfoLog(r);throw this.#w.deleteShader(r),new Error("Failed to compile shader: "+e)}return r}createProgram(e,t){const r=this.#B(e,this.#w.VERTEX_SHADER),o=this.#B(t??"#version 300 es\nprecision mediump float;\nvoid main() { }",this.#w.FRAGMENT_SHADER),a=this.#w.createProgram();if(this.#w.attachShader(a,r),o&&this.#w.attachShader(a,o),this.#w.linkProgram(a),!this.#w.getProgramParameter(a,this.#w.LINK_STATUS)){const e=this.#w.getProgramInfoLog(a);throw this.#w.deleteProgram(a),new Error("Failed to link program: "+e)}return a}useProgram(e){this.#w.useProgram(e)}createVertexArray(e,t){const r=this.#w.createVertexArray();this.#w.bindVertexArray(r);const i=this.#w.createBuffer();if(this.#w.bindBuffer(o,i),this.#w.bufferData(o,e,n),t){const e=this.#w.createBuffer();this.#w.bindBuffer(a,e),this.#w.bufferData(a,t,n)}return r}bindVertexArray(e){this.#w.bindVertexArray(e)}createBuffer(){return this.#w.createBuffer()}bindBuffer(e,t){this.#w.bindBuffer(e,t)}bufferData(e,t,r){this.#w.bufferData(e,t,r)}enableVertexAttribArray(e){this.#w.enableVertexAttribArray(e)}vertexAttribPointer(e,t,r,o,a,n){this.#w.vertexAttribPointer(e,t,r,o,a,n)}uniformMatrix4fv(e,t,r){this.#w.uniformMatrix4fv(e,t,r)}uniform3fv(e,t){this.#w.uniform3fv(e,t)}getUniformLocation(e,t){return this.#w.getUniformLocation(e,t)}clearColor(e){this.#w.clearColor(e.r,e.g,e.b,e.a),this.#w.clear(this.#w.COLOR_BUFFER_BIT)}draw(e,t){this.#w.drawArraysInstanced(this.#w.TRIANGLES,0,e,t)}drawElements(e){this.#w.drawElements(this.#w.TRIANGLES,e,this.#w.UNSIGNED_SHORT,0)}drawIndexed(e,t){this.#w.drawElementsInstanced(this.#w.TRIANGLE_STRIP,e,this.#w.UNSIGNED_SHORT,0,t)}enableDepthTest(){this.#w.enable(this.#w.DEPTH_TEST)}disableDepthTest(){this.#w.disable(this.#w.DEPTH_TEST)}depthFunc(e){this.#w.depthFunc(e)}clearDepth(e){this.#w.clearDepth(e),this.#w.clear(this.#w.DEPTH_BUFFER_BIT)}createImageTexture(e){const t=this.#w,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),r}createDepthTexture(e,t){const r=this.#w,o=r.createTexture();return r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.DEPTH_COMPONENT24,e,t,0,r.DEPTH_COMPONENT,r.UNSIGNED_INT,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,r.LESS),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),o}createDepthFramebuffer(e){const t=this.#w,r=t.createFramebuffer();if(!r)throw new Error("Failed to create shadow framebuffer");t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,e,0),t.drawBuffers([t.NONE]),t.readBuffer(t.NONE);const o=t.checkFramebufferStatus(t.FRAMEBUFFER);if(o!==t.FRAMEBUFFER_COMPLETE)throw new Error(`Incomplete shadow framebuffer: 0x${o.toString(16)}`);return t.bindFramebuffer(t.FRAMEBUFFER,null),r}bindDepthFramebuffer(e){this.#w.bindFramebuffer(this.#w.FRAMEBUFFER,e),this.#w.colorMask(!1,!1,!1,!1)}restoreFramebufferDefaultState(){this.#w.bindVertexArray(null),this.#w.bindFramebuffer(this.#w.FRAMEBUFFER,null),this.#w.colorMask(!0,!0,!0,!0)}deleteTexture(e){this.#w.deleteTexture(e)}deleteFramebuffer(e){this.#w.deleteFramebuffer(e)}bindImageTexture(e,t,r){const o=this.#w;o.activeTexture(o.TEXTURE0+e),o.bindTexture(o.TEXTURE_2D,t),o.uniform1i(r,e)}bindRawDepthTexture(e,t,r){const o=this.#w;o.activeTexture(o.TEXTURE0+e),o.bindTexture(o.TEXTURE_2D,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_COMPARE_MODE,o.NONE),o.uniform1i(r,e)}}}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}};return a[e](r,r.exports,i),r.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",o=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},i.a=(a,n,i)=>{var s;i&&((s=[]).d=-1);var h,u,l,c=new Set,d=a.exports,f=new Promise(((e,t)=>{l=t,u=e}));f[t]=d,f[e]=e=>(s&&e(s),c.forEach(e),f.catch((e=>{}))),a.exports=f,n((a=>{var n;h=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[e])return a;if(a.then){var n=[];n.d=0,a.then((e=>{i[t]=e,o(n)}),(e=>{i[r]=e,o(n)}));var i={};return i[e]=e=>e(n),i}}var s={};return s[e]=e=>{},s[t]=a,s})))(a);var i=()=>h.map((e=>{if(e[r])throw e[r];return e[t]})),u=new Promise((t=>{(n=()=>t(i)).r=0;var r=e=>e!==s&&!c.has(e)&&(c.add(e),e&&!e.d&&(n.r++,e.push(n)));h.map((t=>t[e](r)))}));return n.r?u:i()}),(e=>(e?l(f[r]=e):u(d),o(s)))),s&&s.d<0&&(s.d=0)},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i(398)})();