(()=>{"use strict";const e=WebGL2RenderingContext.ARRAY_BUFFER,r=WebGL2RenderingContext.ELEMENT_ARRAY_BUFFER,t=WebGL2RenderingContext.STATIC_DRAW,a=WebGL2RenderingContext.FLOAT;WebGL2RenderingContext.LESS;class i{#e;#r;constructor(e,r,t){this.#e=e,this.#r=this.#e.createProgram(r,t)}use(){this.#e.useProgram(this.#r)}getUniformLocation(e){const r=this.#e.getUniformLocation(this.#r,e);if(!r)throw new Error(`Failed to get uniform location (${e})`);return r}}var n,o="undefined"!=typeof Float32Array?Float32Array:Array;function s(e,r){var t=new o(2);return t[0]=e,t[1]=r,t}function l(e,r,t){var a=new o(3);return a[0]=e,a[1]=r,a[2]=t,a}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)}),n=new o(2),o!=Float32Array&&(n[0]=0,n[1]=0),function(){var e=new o(3);o!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0)}();const E={r:.1921,g:.302,b:.4745,a:1},h=[{pos:s(-.5,-.5),color:l(1,0,0)},{pos:s(.5,-.5),color:l(0,1,0)},{pos:s(.5,.5),color:l(0,0,1)},{pos:s(-.5,.5),color:l(1,1,1)}],g=[0,1,2,2,3,0];class T{#e;#r;#t;constructor(e){this.#e=e,this.#r=new i(e,"#version 300 es\nprecision mediump float;\n\nlayout(location = 0) in vec2 aPosition;\nlayout(location = 1) in vec3 aColor;\n\nout vec3 vColor;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n    vColor = aColor;\n}\n","#version 300 es\nprecision mediump float;\n\nin  vec3 vColor;\nout vec4 outColor;\n\nvoid main() {\n    outColor = vec4(vColor, 1.0);\n}\n"),this.#t=e.createVertexArray(function(e){const r=new Float32Array(5*e.length);for(let t=0;t<e.length;t++){const a=5*t;r.set(e[t].pos,a+0),r.set(e[t].color,a+2)}return r}(h),new Uint16Array(g)),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,a,!1,20,0),e.enableVertexAttribArray(1),e.vertexAttribPointer(1,3,a,!1,20,8)}recordCommands(){this.#e.clearColor(E),this.#r.use(),this.#e.bindVertexArray(this.#t),this.#e.drawIndexed(g.length,1)}}const c=document.getElementById("canvas"),u=new class{#e;constructor(e){this.#e=e}#a(e,r){const t=this.#e.createShader(r);if(!t)throw new Error("Failed to create shader");if(this.#e.shaderSource(t,e),this.#e.compileShader(t),!this.#e.getShaderParameter(t,this.#e.COMPILE_STATUS)){const e=this.#e.getShaderInfoLog(t);throw this.#e.deleteShader(t),new Error("Failed to compile shader: "+e)}return t}createProgram(e,r){const t=this.#a(e,this.#e.VERTEX_SHADER),a=this.#a(r??"#version 300 es\nprecision mediump float;\nvoid main() { }",this.#e.FRAGMENT_SHADER),i=this.#e.createProgram();if(this.#e.attachShader(i,t),a&&this.#e.attachShader(i,a),this.#e.linkProgram(i),!this.#e.getProgramParameter(i,this.#e.LINK_STATUS)){const e=this.#e.getProgramInfoLog(i);throw this.#e.deleteProgram(i),new Error("Failed to link program: "+e)}return i}useProgram(e){this.#e.useProgram(e)}createVertexArray(a,i){const n=this.#e.createVertexArray();this.#e.bindVertexArray(n);const o=this.#e.createBuffer();if(this.#e.bindBuffer(e,o),this.#e.bufferData(e,a,t),i){const e=this.#e.createBuffer();this.#e.bindBuffer(r,e),this.#e.bufferData(r,i,t)}return n}bindVertexArray(e){this.#e.bindVertexArray(e)}createBuffer(){return this.#e.createBuffer()}bindBuffer(e,r){this.#e.bindBuffer(e,r)}bufferData(e,r,t){this.#e.bufferData(e,r,t)}enableVertexAttribArray(e){this.#e.enableVertexAttribArray(e)}vertexAttribPointer(e,r,t,a,i,n){this.#e.vertexAttribPointer(e,r,t,a,i,n)}uniformMatrix4fv(e,r,t){this.#e.uniformMatrix4fv(e,r,t)}uniform3fv(e,r){this.#e.uniform3fv(e,r)}getUniformLocation(e,r){return this.#e.getUniformLocation(e,r)}clearColor(e){this.#e.clearColor(e.r,e.g,e.b,e.a),this.#e.clear(this.#e.COLOR_BUFFER_BIT)}draw(e,r){this.#e.drawArraysInstanced(this.#e.TRIANGLES,0,e,r)}drawElements(e){this.#e.drawElements(this.#e.TRIANGLES,e,this.#e.UNSIGNED_SHORT,0)}drawIndexed(e,r){this.#e.drawElementsInstanced(this.#e.TRIANGLE_STRIP,e,this.#e.UNSIGNED_SHORT,0,r)}enableDepthTest(){this.#e.enable(this.#e.DEPTH_TEST)}disableDepthTest(){this.#e.disable(this.#e.DEPTH_TEST)}depthFunc(e){this.#e.depthFunc(e)}clearDepth(e){this.#e.clearDepth(e),this.#e.clear(this.#e.DEPTH_BUFFER_BIT)}createImageTexture(e){const r=this.#e,t=r.createTexture();return r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.bindTexture(r.TEXTURE_2D,null),t}createDepthTexture(e,r){const t=this.#e,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT24,e,r,0,t.DEPTH_COMPONENT,t.UNSIGNED_INT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_FUNC,t.LESS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),a}createDepthFramebuffer(e){const r=this.#e,t=r.createFramebuffer();if(!t)throw new Error("Failed to create shadow framebuffer");r.bindFramebuffer(r.FRAMEBUFFER,t),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,e,0),r.drawBuffers([r.NONE]),r.readBuffer(r.NONE);const a=r.checkFramebufferStatus(r.FRAMEBUFFER);if(a!==r.FRAMEBUFFER_COMPLETE)throw new Error(`Incomplete shadow framebuffer: 0x${a.toString(16)}`);return r.bindFramebuffer(r.FRAMEBUFFER,null),t}bindDepthFramebuffer(e){this.#e.bindFramebuffer(this.#e.FRAMEBUFFER,e),this.#e.colorMask(!1,!1,!1,!1)}restoreFramebufferDefaultState(){this.#e.bindVertexArray(null),this.#e.bindFramebuffer(this.#e.FRAMEBUFFER,null),this.#e.colorMask(!0,!0,!0,!0)}deleteTexture(e){this.#e.deleteTexture(e)}deleteFramebuffer(e){this.#e.deleteFramebuffer(e)}bindImageTexture(e,r){const t=this.#e;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.uniform1i(r,0)}bindRawDepthTexture(e,r){const t=this.#e;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_COMPARE_MODE,t.NONE),t.uniform1i(r,0)}}(c.getContext("webgl2")),f=new class{#i;constructor(e){this.#i=new T(e)}render(){this.#i.recordCommands()}}(u);!function e(){f.render(),requestAnimationFrame(e)}()})();